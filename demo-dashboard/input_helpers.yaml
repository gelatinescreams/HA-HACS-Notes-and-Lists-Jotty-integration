# =============================================================================
# JOTTY HOME ASSISTANT INTEGRATION VIA HACS
# These helpers MUST be created for Jotty to work properly
# Go to Settings > Devices & Services > Helpers > Create Helper
# Create each helper exactly as specified below
# =============================================================================

#under input_text
input_text:

  jotty_editing_recurring_id:
    name: "Editing Recurring ID"
    initial: ""
    max: 255

  jotty_editing_recurring_type:
    name: "Editing Recurring Type"
    initial: ""
    max: 20

  jotty_editing_recurring_title:
    name: "Editing Recurring Title"
    initial: ""
    max: 255

  jotty_recurring_reset_times:
    name: "Reset Times"
    initial: "06:00"
    max: 255
    icon: mdi:clock-outline
    
  jotty_editing_reminder_id:
    name: "Editing Reminder ID"
    initial: ""
    max: 255

  jotty_editing_reminder_type:
    name: "Editing Reminder Type"
    initial: ""
    max: 20

  jotty_editing_reminder_title:
    name: "Editing Reminder Title"
    initial: ""
    max: 255
    
  jotty_note_id:
    name: "Note ID"
    initial: ""
    max: 255

  jotty_quick_action_data:
    name: Quick Action Data
    max: 255
    icon: mdi:cog

  jotty_note_title:
    name: "Note Title"
    initial: ""
    max: 255

  jotty_note_content:
    name: "Note Content"
    initial: ""
    max: 255
    mode: text

  jotty_edit_note_content:
    name: "Edit Note Content"
    initial: ""
    max: 255
    mode: text

  jotty_edit_note_title:
    name: "Edit Note Title"
    initial: ""
    max: 255

  jotty_checklist_id:
    name: "Checklist ID"
    initial: ""
    max: 255

  jotty_checklist_title:
    name: "Checklist Title"
    initial: ""
    max: 255

  jotty_task_title:
    name: "Task Title"
    initial: ""
    max: 255
    
  jotty_selected_checklist_id:
    name: "Selected Checklist ID"
    initial: ""
    max: 255

  jotty_selected_checklist_title:
    name: "Selected Checklist Title"
    initial: ""
    max: 255

  jotty_selected_checklist_type:
    name: "Selected Checklist Type"
    initial: "simple"
    max: 50

  jotty_item_text:
    name: "Item Text"
    initial: ""
    max: 255

  jotty_loading_item:
    name: "Loading Item"
    initial: ""
    max: 100
  jotty_quick_task_action_data:
    name: Quick Task Action Data
    max: 255
    icon: mdi:clipboard-list

  jotty_quick_delete_item_data:
    name: Quick Delete Item Data
    max: 255
    icon: mdi:delete

  jotty_selected_task_id:
    name: "Selected Task ID"
    initial: ""
    max: 255

  jotty_selected_task_title:
    name: "Selected Task Title"
    initial: ""
    max: 255

  jotty_task_item_text:
    name: "Task Item Text"
    initial: ""
    max: 255
  jotty_new_status_id:
    name: "New Status ID"
    initial: ""
    max: 50
    icon: mdi:identifier

  jotty_new_status_label:
    name: "New Status Label"
    initial: ""
    max: 100
    icon: mdi:label

  jotty_new_status_color:
    name: "New Status Color"
    initial: "#3b82f6"
    max: 20
    icon: mdi:palette

  jotty_edit_status_id:
    name: "Edit Status ID"
    initial: ""
    max: 50

  jotty_edit_status_label:
    name: "Edit Status Label"
    initial: ""
    max: 100

  jotty_edit_status_color:
    name: "Edit Status Color"
    initial: ""
    max: 20

  jotty_kanban_action_data:
    name: Kanban Action Data
    max: 255
    icon: mdi:view-column

  jotty_parent_item_index:
    name: "Parent Item Index"
    initial: ""
    max: 50
    icon: mdi:file-tree  

#under input_select  
input_select:

  jotty_recurring_days:
    name: "Recurring Days"
    options:
      - "Weekdays"
      - "Weekends"
      - "Every day"
    initial: "Every day"
    icon: mdi:calendar-week


  jotty_reminder_target:
    name: "Remind Who"
    options:
      - "Nobody"
    initial: "Nobody"
    icon: mdi:account-bell

  jotty_reminder_interval:
    name: "Remind Every"
    options:
      - "30 minutes"
      - "1 hour"
      - "2 hours"
      - "4 hours"
      - "8 hours"
      - "12 hours"
      - "Once a day"
    initial: "1 hour"
    icon: mdi:timer-outline

  jotty_reminder_days:
    name: "On Days"
    options:
      - "Weekdays"
      - "Weekends"
      - "Every day"
    initial: "Weekdays"
    icon: mdi:calendar-week
    
  jotty_status_picker:
    name: "Status Column Picker"
    options:
      - "-- Select status --"
    initial: "-- Select status --"
    icon: mdi:view-column
  jotty_checklist_type:
    name: "Checklist Type"
    options:
      - "simple"
      - "task"
    initial: "simple"

  jotty_task_status:
    name: "Task Status"
    options:
      - "todo"
      - "in_progress"
      - "paused"
      - "completed"
    initial: "todo"

  jotty_note_picker:
    name: "Note Picker"
    options:
      - "-- Pick a note --"
    initial: "-- Pick a note --"

  jotty_checklist_picker:
    name: "Checklist Picker"
    options:
      - "-- Pick a checklist --"
    initial: "-- Pick a checklist --"

  jotty_item_picker:
    name: "Item Picker"
    options:
      - "-- Select item --"
    initial: "-- Select item --"

  jotty_task_picker:
    name: "Task Picker"
    options:
      - "-- Pick a task list --"
    initial: "-- Pick a task list --"

  jotty_task_item_picker:
    name: "Task Item Picker"
    options:
      - "-- Select task item --"
    initial: "-- Select task item --"

  jotty_new_task_item_status:
    name: "New Task Item Status"
    options:
      - "todo"
      - "in_progress"
      - "completed"
    initial: "todo"
    
  jotty_item_status:
    name: "Item Status"
    options:
      - "-- Select status --"
      - "todo"
      - "in_progress"
      - "paused"
      - "completed"
    initial: "-- Select status --"

#under input_number 
input_number:

  jotty_selected_item_index:
    name: "Selected Item Index"
    min: 0
    max: 1000
    step: 1
    initial: 0
    mode: box
  jotty_new_status_order:
    name: "New Status Order"
    initial: 0
    min: 0
    max: 20
    step: 1
    mode: box
    icon: mdi:sort-numeric-ascending    

#under input_boolean    
input_boolean:

  jotty_show_recurring_popup:
    name: "Show Recurring Popup"
    initial: false
    icon: mdi:recycle
    
  jotty_item_completed:
    name: "Item Completed"
    initial: false

  jotty_is_loading:
    name: "Is Loading"
    initial: false
    icon: mdi:loading

  jotty_enable_reminder:
    name: "Enable Reminder"
    initial: false
    icon: mdi:bell-plus

  jotty_show_reminder_popup:
    name: "Show Reminder Popup"
    initial: false
    icon: mdi:popup
    
input_datetime:    

  jotty_reminder_start:
    name: "From Time"
    has_date: false
    has_time: true

  jotty_reminder_end:
    name: "Until Time"
    has_date: false
    has_time: true

#at the bottom of config    
template:

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jotty_reminder_update
    sensor:
      - name: "Jotty Reminders"
        unique_id: jotty_reminders_storage
        state: >
          {% if trigger.platform == 'event' and trigger.event.data.configs is defined %}
            {{ trigger.event.data.configs | length }}
          {% else %}
            {{ this.attributes.configs | default({}) | length }}
          {% endif %}
        attributes:
          configs: >
            {% if trigger.platform == 'event' and trigger.event.data.configs is defined %}
              {{ trigger.event.data.configs }}
            {% else %}
              {{ this.attributes.configs | default({}) }}
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: time_pattern
        hours: "/6"
    sensor:
      - name: "Jotty Available Notifiers"
        unique_id: jotty_available_notifiers
        state: "{{ this.attributes.notifiers | default([]) | length }}"
        attributes:
          notifiers: >
            {% set devices = integration_entities('mobile_app') | select('match','device_tracker') | expand | map(attribute='name') | map('slugify') | list %}
            {% set ns = namespace(services=[]) %}
            {% for device in devices %}
              {% set ns.services = ns.services + ['notify.mobile_app_' ~ device] %}
            {% endfor %}
            {{ ns.services }}
  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jotty_recurring_update
    sensor:
      - name: "Jotty Recurring"
        unique_id: jotty_recurring_storage
        state: >
          {% if trigger.platform == 'event' and trigger.event.data.configs is defined %}
            {{ trigger.event.data.configs | length }}
          {% else %}
            {{ this.attributes.configs | default({}) | length }}
          {% endif %}
        attributes:
          configs: >
            {% if trigger.platform == 'event' and trigger.event.data.configs is defined %}
              {{ trigger.event.data.configs }}
            {% else %}
              {{ this.attributes.configs | default({}) }}
            {% endif %}      